# 코인 자동투자 프로그램 제작

1. **환경변수 설정**:
   - 아래 변수를 환경변수에 저장하고 불러와서 활용합니다.
     A. `UPBIT_ACCESS_KEY`
     B. `UPBIT_SECRET_KEY`
     C. `SLACK_API_TOKEN`
     D. `SLACK_CHANNEL_ID`
     E. `COIN_TICKER`

2. **UPBIT API 활용**:
   - 자산 조회 및 매수/매도 주문을 실행합니다.

3. **SLACK API 활용**:
   - 투자 상황을 슬랙에 로깅합니다.

4. **기술적 지표 분석 및 조합**:
   - 여러 기술적 지표를 분석하고 적절히 조합하여 사용합니다.
   - 선행지표와 후행지표를 각 장점에 맞게 적용하여 투자에 활용합니다.

5. **코드 흐름**:
   A. 기존 자산 확인 후 손절 가격, 이익 실현 가격을 저장하고 포지션 정보를 출력합니다.
   B. 반복문 시작 - 데이터 수집
   C. 매수 및 매도 조건 판단
   D. **보조 지표 스코어링 시스템에 따라 포지션 크기 결정**
   E. 매수 조건 충족 시 희망 가격 설정 후 해당 가격의 1.005배로 지정가 주문
   F. 10초간 대기 후 주문 체결 확인. 체결되지 않은 경우 주문 취소
   G. 매도 조건 충족 시 시장가 주문
   H. 10초간 대기 후 매도 실현 확인, 포지션 정보 변경
   I. 매수/매도 조건 미충족 시 "홀드" 출력 후 10초 대기
   J. 조건문 종료 - 20초 대기

---

## 매수/매도 조건 정리

### **1. 전략 개요**

- **1분봉 차트에서 매매 신호 포착**: **RSI**, **볼린저 밴드**, **%B 지표**, **볼린저 밴드 폭(BBW)**를 사용하여 핵심 매매 신호를 탐색합니다.
- **보조 지표를 활용한 포지션 크기 조절**: **거래량**, **OBV**, **BBW** 등의 보조 지표에 스코어를 매겨, 전체 자본의 일정 비율(점수/만점)만큼 매수/매도합니다.
- **리스크 관리**: **손절매**와 **이익 실현** 지점을 설정하여 리스크를 관리합니다.

---

### **2. 1분봉 차트에서 매매 신호 포착 및 포지션 크기 결정**

#### **핵심 매매 조건 (매매 결정에 사용)**

**매수 조건**:

1. **RSI**가 **30 이하**에서 상승 반전.
2. 가격이 **볼린저 밴드 하단**을 터치하거나 하향 돌파 후 반등.
3. **%B 지표**가 **0 이하**에서 상승.
4. **BBW**가 **자신의 이동평균을 상향 돌파**할 때.

**매도 조건**:

1. **RSI**가 **70 이상**에서 하락 반전.
2. 가격이 **볼린저 밴드 상단**을 터치하거나 상향 돌파 후 하락.
3. **%B 지표**가 **1 이상**에서 하락.
4. **BBW**가 **자신의 이동평균을 하향 돌파**할 때.

**핵심 조건이 모두 충족될 때 매매를 실행합니다.**

#### **보조 지표 스코어링 시스템 (포지션 크기 결정에 사용)**

**사용 지표**:

- **거래량**
- **OBV (On-Balance Volume)**
- **볼린저 밴드 폭(BBW)**

**스코어링 방법**:

- 각 보조 지표에 대해 **0점**에서 **2점**까지 부여합니다.

  - **거래량**:
    - 평균 거래량보다 낮으면 **0점**.
    - 평균 거래량과 비슷하면 **1점**.
    - 평균 거래량보다 높으면 **2점**.

  - **OBV**:
    - 추세 변화 없음 또는 불리한 방향이면 **0점**.
    - 약간의 추세 변화가 있으면 **1점**.
    - 유리한 방향으로 강한 추세 변화가 있으면 **2점**.

  - **BBW**:
    - **BBW 수준 평가**:
      - **낮은 BBW (변동성 낮음)**: **0점**
        - 현재 BBW가 20기간 이동평균의 **80% 미만**일 때.
      - **중간 BBW (변동성 보통)**: **1점**
        - 현재 BBW가 20기간 이동평균의 **80%에서 120% 사이**일 때.
      - **높은 BBW (변동성 높음)**: **2점**
        - 현재 BBW가 20기간 이동평균의 **120% 초과**일 때.

**포지션 크기 결정**:

- 보조 지표의 총합 스코어에 따라 전체 자산의 일정 비율로 포지션 크기를 정합니다.
  - **최대 스코어**: 각 지표당 2점씩, 총 **6점**
  - **총 스코어 0-1점**:
    - 포지션 진입을 보류하거나 **최소 포지션 크기**로 진입.
  - **총 스코어 2-3점**:
    - 전체 자산의 **(총 스코어 / 6) × 50%** 만큼 매매.
  - **총 스코어 4-6점**:
    - 전체 자산의 **(총 스코어 / 6) × 100%** 만큼 매매.

---

### **3. 리스크 관리**

**손절매 설정**:

- **ATR (Average True Range)**를 활용하여 손절매 지점을 설정합니다.

- **변동성에 따른 손절매 범위 조정**:

  - **높은 BBW (변동성 높음)**:
    - **손절매**: ATR의 **1.5배** 지점에 설정.
  - **낮은 BBW (변동성 낮음)**:
    - **손절매**: ATR의 **0.75배** 지점에 설정.

- **매수 포지션**:
  - 진입 가격에서 최근 **스윙 로우(swing low)** 아래에 손절매 설정.
- **매도 포지션**:
  - 진입 가격에서 최근 **스윙 하이(swing high)** 위에 손절매 설정.

**이익 실현 설정**:

- **리스크 대비 보상 비율**을 **1:2 이상**으로 설정합니다.

- **변동성에 따른 이익 실현 범위 조정**:

  - **높은 BBW (변동성 높음)**:
    - **이익 실현**: ATR의 **3배** 지점에 설정.
  - **낮은 BBW (변동성 낮음)**:
    - **이익 실현**: ATR의 **1.5배** 지점에 설정.

- **볼린저 밴드의 반대편** 또는 **주요 지지/저항 수준**을 목표가로 설정합니다.

---

### **4. 거래 관리**

**실행 시간대**:

- 시간대 구분 없이 **24시간 전략을 실행**합니다.

**모니터링 및 조정**:

- 포지션 진입 후 시장 변동성을 모니터링하고, 필요 시 손절매 지점을 조정합니다.
- **트레일링 스탑**을 활용하여 이익을 보호합니다.

**거래 종료**:

- 설정한 **이익 실현 지점** 또는 **손절매 지점**에 도달하면 포지션을 청산합니다.
- **반대 신호**가 발생하면 포지션을 재평가하고 필요 시 청산합니다.

---

### **5. 전략 실행 단계 요약**

1. **1분봉에서 핵심 매매 신호 탐색**:
   - **RSI**, **볼린저 밴드**, **%B 지표**, **BBW 조건**의 핵심 조건이 모두 충족되는지 확인합니다.

2. **보조 지표 스코어링 및 포지션 크기 결정**:
   - **거래량**, **OBV**, **BBW**에 스코어를 부여하여 총합 스코어를 계산합니다.
   - 총합 스코어에 따라 포지션 크기를 결정합니다.

3. **포지션 진입 및 리스크 관리 설정**:
   - **BBW에 따른 손절매와 이익 실현 지점**을 설정하고 포지션에 진입합니다.

4. **거래 모니터링 및 종료**:
   - 시장 상황과 **BBW 변동**을 모니터링하고, 설정한 조건에 따라 포지션을 관리합니다.